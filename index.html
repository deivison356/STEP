<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Prova Online</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }

    body.dark {
      background: #121212;
      color: #fff;
    }

    #acesso, #cronometro, #calculadora, #iframe, #modoEscuroToggle {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }

    iframe {
      width: 90%;
      height: 500px;
      border: none;
      display: none;
    }

    #calculadora {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      z-index: 1000;
    }

    body.dark #calculadora {
      background: #333;
      border-color: #666;
    }

    #calculadora button {
      width: 40px;
      height: 40px;
      margin: 2px;
    }

    #modoEscuroToggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
    }
  </style>
</head>
<body>
  <div id="acesso">
    <h2>Digite a senha para iniciar a prova</h2>
    <input type="password" id="senha" placeholder="Senha (ddmmaaaa)">
    <button id="btnIniciar">Iniciar Prova</button>
  </div>

  <div id="cronometro" style="display:none; font-size: 24px;"></div>

  <iframe id="iframe" src="https://docs.google.com/forms/d/e/1FAIpQLSfTH8OBK_0T3HNO9CqTGqKSjXcjxpKJJ0PImnJceY6R7usQ-A/viewform?usp=header"></iframe>

  <div id="calculadora">
    <input type="text" id="visor" readonly style="width: 170px; margin-bottom: 5px; text-align: right;">
    <div>
      <button onclick="adicionar('+')">+</button>
      <button onclick="adicionar('-')">-</button>
      <button onclick="adicionar('*')">*</button>
      <button onclick="adicionar('/')">/</button>
    </div>
    <div>
      <button onclick="adicionar('7')">7</button>
      <button onclick="adicionar('8')">8</button>
      <button onclick="adicionar('9')">9</button>
      <button onclick="limpar()">C</button>
    </div>
    <div>
      <button onclick="adicionar('4')">4</button>
      <button onclick="adicionar('5')">5</button>
      <button onclick="adicionar('6')">6</button>
      <button onclick="calcular()">=</button>
    </div>
    <div>
      <button onclick="adicionar('1')">1</button>
      <button onclick="adicionar('2')">2</button>
      <button onclick="adicionar('3')">3</button>
      <button onclick="adicionar('0')">0</button>
    </div>
  </div>

  <div id="modoEscuroToggle">
    <label><input type="checkbox" onchange="toggleModoEscuro()"> Modo Escuro</label>
  </div>

  <audio id="alertaAudio" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <script>
    const btnIniciar = document.getElementById('btnIniciar');
    const acesso = document.getElementById('acesso');
    const iframe = document.getElementById('iframe');
    const cronometro = document.getElementById('cronometro');
    const alertaAudio = document.getElementById('alertaAudio');

    let tempoRestante = 60 * 60;
    let intervaloCronometro;
    let penalidades = 0;
    const maxPenalidades = 3;

    function atualizarCronometro() {
      const minutos = Math.floor(tempoRestante / 60);
      const segundos = tempoRestante % 60;
      cronometro.textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
      tempoRestante--;

      if (tempoRestante < 0) {
        clearInterval(intervaloCronometro);
        alert("Tempo esgotado! A prova será encerrada.");
        window.close();
      }
    }

    function entrarEmTelaCheia() {
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
      }
    }

    function validarSenha() {
      const senhaDigitada = document.getElementById('senha').value.trim();
      const hoje = new Date();
      const dia = String(hoje.getDate()).padStart(2, '0');
      const mes = String(hoje.getMonth() + 1).padStart(2, '0');
      const ano = hoje.getFullYear();
      const senhaCorreta = dia + mes + ano;

      if (senhaDigitada === senhaCorreta) {
        acesso.style.display = 'none';
        iframe.style.display = 'block';
        cronometro.style.display = 'block';
        entrarEmTelaCheia();
        intervaloCronometro = setInterval(atualizarCronometro, 1000);
      } else {
        alert('Senha incorreta!');
      }
    }

    btnIniciar.addEventListener('click', validarSenha);

    window.onblur = () => {
      if (penalidades < maxPenalidades) {
        penalidades++;
        alertaAudio.play();
        if (tempoRestante <= 30 * 60) {
          tempoRestante -= 10 * 60;
        } else {
          tempoRestante = 0;
        }
        alert(`Você saiu da aba! Penalidade ${penalidades}/${maxPenalidades}.`);
      } else {
        clearInterval(intervaloCronometro);
        alert("Você excedeu o número de saídas permitidas. A prova será encerrada.");
        window.close();
      }
    };

    function adicionar(valor) {
      document.getElementById('visor').value += valor;
    }

    function limpar() {
      document.getElementById('visor').value = '';
    }

    function calcular() {
      try {
        document.getElementById('visor').value = eval(document.getElementById('visor').value);
      } catch {
        document.getElementById('visor').value = 'Erro';
      }
    }

    function toggleModoEscuro() {
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
