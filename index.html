<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Prova Online</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      color: #000;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background-color: #1e1e1e;
      color: #fff;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #007bff;
      color: white;
    }
    .toggle-btn {
      background: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
    }
    #timer {
      font-size: 18px;
      font-weight: bold;
    }
    #startBtn {
      margin: 50px auto;
      display: block;
      padding: 20px;
      font-size: 24px;
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
    iframe {
      width: 100%;
      height: calc(100vh - 100px);
      border: none;
    }
    .notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background-color: red;
      color: white;
      padding: 10px;
      font-weight: bold;
      z-index: 9999;
    }
    .calculator {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      z-index: 9999;
    }
    .calculator input {
      width: 100px;
      margin: 5px;
    }
    .calculator button {
      margin: 3px;
      width: 40px;
      height: 40px;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div id="timer">Tempo restante: 90:00</div>
    <button class="toggle-btn" onclick="toggleTheme()">üåô Modo Escuro / ‚òÄÔ∏è Modo Claro</button>
  </div>
  <button id="startBtn" onclick="startExam()">Iniciar Prova</button>

  <div class="calculator" id="calculator">
    <input type="text" id="calcDisplay" disabled><br>
    <div>
      <button onclick="press('+')">+</button>
      <button onclick="press('-')">-</button>
      <button onclick="press('*')">*</button>
      <button onclick="press('/')">/</button>
    </div>
    <div>
      <button onclick="press('7')">7</button>
      <button onclick="press('8')">8</button>
      <button onclick="press('9')">9</button>
    </div>
    <div>
      <button onclick="press('4')">4</button>
      <button onclick="press('5')">5</button>
      <button onclick="press('6')">6</button>
    </div>
    <div>
      <button onclick="press('1')">1</button>
      <button onclick="press('2')">2</button>
      <button onclick="press('3')">3</button>
    </div>
    <div>
      <button onclick="press('0')">0</button>
      <button onclick="clearCalc()">C</button>
      <button onclick="calculate()">=</button>
    </div>
  </div>

  <iframe id="examFrame" src="" style="display:none;"></iframe>

  <div id="notification" class="notification" style="display:none;">Voc√™ foi penalizado por sair da aba!</div>

  <script>
    let totalTime = 90 * 60; // 90 minutos em segundos
    let penalizationsLeft = 3;
    let timerInterval;
    let currentTime = totalTime;

    function startExam() {
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('examFrame').style.display = 'block';
      document.getElementById('examFrame').src = "https://docs.google.com/forms/d/e/1FAIpQLSfTH8OBK_0T3HNO9CqTGqKSjXcjxpKJJ0PImnJceY6R7usQ-A/viewform?usp=header";
      startTimer();
    }

    function startTimer() {
      updateTimerDisplay(); // Atualiza na hora do start
      timerInterval = setInterval(() => {
        currentTime--;
        updateTimerDisplay();
        if (currentTime <= 0) {
          clearInterval(timerInterval);
          alert("Tempo esgotado. A prova ser√° encerrada.");
          window.close();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = String(Math.floor(currentTime / 60)).padStart(2, '0');
      const seconds = String(currentTime % 60).padStart(2, '0');
      document.getElementById('timer').textContent = `Tempo restante: ${minutes}:${seconds}`;
    }

    document.addEventListener('visibilitychange', () => {
      if (document.hidden && penalizationsLeft > 0) {
        if (currentTime <= 30 * 60) {
          currentTime -= 600; // 10 minutos
        } else {
          currentTime -= 1800; // 30 minutos
        }
        penalizationsLeft--;
        showNotification();
        if (penalizationsLeft === 0) {
          alert("Voc√™ excedeu o n√∫mero de penaliza√ß√µes. A prova ser√° encerrada.");
          window.close();
        }
      }
    });

    function showNotification() {
      const notification = document.getElementById('notification');
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 5000);
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    // Calculadora
    let calcDisplay = document.getElementById("calcDisplay");
    function press(value) {
      calcDisplay.value += value;
    }
    function clearCalc() {
      calcDisplay.value = "";
    }
    function calculate() {
      try {
        calcDisplay.value = eval(calcDisplay.value);
      } catch (e) {
        calcDisplay.value = "Erro";
      }
    }
  </script>
</body>
</html>
